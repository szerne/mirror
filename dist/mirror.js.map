{"version":3,"sources":["mirror.js"],"names":["clockComponent","$","mainMessageComponent","degreeChar","String","fromCharCode","createForecastHour","forecast","el","hour","icon","temp","onForecastReady","table","empty","hourly","forEach","h","td","append","onConditionsReady","conditions","targetEl","conditionsEl","location","weather","getCoords","coords","subscribe","setGreeting","text","getCompliment","init","now","time","newsTargetEl","showingArticles","renderQrCode","article","qrcode","url","background","foreground","height","width","renderNewsArticle","articleEl","urlToImage","title","description","getNewsSourceEl","source","name","renderNewsSourcesPage","sources","s","getNewsSources","unsubscribe","getSources","getNext","getNextPageSources","returnToNews","getNewsFrom","changeSource","commandsEl","showCommands","getTriggers","com","setTimeout","whenSaid","start"],"mappings":"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","file":"mirror.js","sourcesContent":["import '../node_modules/jquery.qrcode/jquery.qrcode.min';\nimport { Location } from 'location';\nimport { weatherService } from 'weather';\nimport { greetingService } from 'greeting';\nimport { voiceService } from 'voiceService';\nimport { clock } from 'clock';\nimport { newsService } from 'newsService';\n\nconst clockComponent = $('#clock');\nconst mainMessageComponent = $('#greeting');\n\n/********* WEATHER *********/\nconst degreeChar = String.fromCharCode(176);\n\nconst createForecastHour = (forecast) => {\n    let el = `<div class=\"forecast hour\">${forecast.hour}</div>` + \n            `<img class=\"forecast icon\" src=\"${forecast.icon}\" />` +\n            `<div class=\"forecast temp\">` +\n                `<span>${forecast.temp}</span>` +\n                `<span class=\"degree\">${degreeChar}</span>` +\n            `</div>`;\n    return el;\n}\n\nconst onForecastReady = (forecast) => {\n    let table = $('.hourly-forecast');\n    table.empty();\n    forecast.hourly.forEach((h) => {\n        let td = $(`<td>${createForecastHour(h)}</td>`)\n        table.append(td);\n    })\n};\n\nconst onConditionsReady = (conditions) => {\n    let targetEl = $('.current-temp');\n    let conditionsEl = $(`<h5>${conditions.location}</h5>` +\n                        `<h1>${conditions.temp}${degreeChar}</h1>` +\n                        `<p>${conditions.weather}</p>` +\n                        `<img src=\"${conditions.icon}\"/>`);\n    targetEl.empty();\n    targetEl.append(conditionsEl);\n}\n\nconst location = new Location();\nlocation.getCoords((coords) => {\n    weatherService.subscribe('forecast', 900000, coords, onForecastReady);\n    weatherService.subscribe('conditions', 1800000, coords, onConditionsReady);\n});\n\n/********* GREETING *********/\nconst setGreeting = () => {\n    mainMessageComponent.text(greetingService.getCompliment());\n};\nsetGreeting();\n\n/********* CLOCK *********/\nclock.init((now) => {\n    clockComponent.text(now.time);\n});\n\n/********* NEWS FEED *********/\nconst newsTargetEl = $('#news-feed');\nlet showingArticles = true;\n\nconst renderQrCode = (article) => {\n    $('#qrcode').empty();\n    $('#qrcode').qrcode({\n        text: article.url,\n        background: '#FFFFFF',\n        foreground: '#000000',\n        height: 100,\n        width: 100\n    });\n}\n\nconst renderNewsArticle = (article) => {\n    if (!showingArticles) return;\n\n    newsTargetEl.empty();\n    let articleEl = $(`<div class=\"row\">` +\n                        `<img class=\"thumbnail three columns\" src=\"${article.urlToImage}\" onerror=\"this.src='images/day/unknown.png'\"/>` + \n                        `<div class=\"seven columns\">` +\n                            `<h5>${article.title}</h3>` +\n                            `<p>${article.description}</p>` +\n                        `</div>` +\n                        `<div id=\"qrcode\" class=\"two columns\"></div>` +\n                    `</div>`);\n    newsTargetEl.append(articleEl);\n    renderQrCode(article);\n}\n\nconst getNewsSourceEl = (source) => {\n    return $(`<div class=\"three columns news-source\">` +\n                `${source.name}` + \n            `</div>`);\n}\n\nconst renderNewsSourcesPage = (sources) => {\n    newsTargetEl.empty();\n    sources.forEach((s) => {\n        newsTargetEl.append(getNewsSourceEl(s));\n    });\n}\n\nconst getNewsSources = () => {\n    showingArticles = false;\n    newsService.unsubscribe();\n    newsService.getSources(renderNewsSourcesPage);\n}\n\nconst getNext = () => {\n    let sources = newsService.getNextPageSources();\n    renderNewsSourcesPage(sources);\n}\n\nconst returnToNews = () => {\n    if (showingArticles) return;\n        showingArticles = true;\n        newsService.unsubscribe();\n        newsService.subscribe(45, 45, renderNewsArticle);\n}\n\nconst getNewsFrom = (source) => {\n    showingArticles = true;\n    newsService.unsubscribe();\n    newsService.changeSource(source, () => {\n        newsService.subscribe(45, 45, renderNewsArticle);\n    });\n}\n\nnewsService.subscribe(45, 45, renderNewsArticle);\n\n/********* VOICE *********/\nconst commandsEl = $('<ul></ul>');\n\nconst showCommands = () => {\n    mainMessageComponent.empty();\n    voiceService.getTriggers().forEach((com) => {\n        if (com === 'Show me commands') return;\n        commandsEl.append(`<li class=\"command\">${com}</li>`);\n    });\n    mainMessageComponent.append(commandsEl);\n    setTimeout(setGreeting, 20000)\n}\n\nvoiceService\n    .whenSaid('Show me commands', showCommands)\n    .whenSaid('How do I look', setGreeting)\n    .whenSaid('Show me news sources', getNewsSources)\n    .whenSaid('Show me next', getNext)\n    .whenSaid('Show me the news', returnToNews)\n    .whenSaid('Show me news from *source', getNewsFrom)\n    .start();"]}